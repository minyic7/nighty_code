%%{init: {'theme':'dark', 'themeVariables': { 'primaryColor':'#1f2937', 'primaryTextColor':'#fff', 'primaryBorderColor':'#7C3AED', 'lineColor':'#F59E0B', 'secondaryColor':'#6366F1', 'tertiaryColor':'#10B981'}}}%%

graph TB
    %% Copilot Module - Brain-like Cognitive Architecture
    
    subgraph Input["üé§ Sensory Input"]
        UserQuery[/"User Query<br/>Natural Language"/]
        Context[/"Context<br/>History & Environment"/]
        Signals[/"Signals<br/>Events & Triggers"/]
    end
    
    subgraph CerebralCortex["üß† Cerebral Cortex - Higher Processing"]
        
        subgraph PrefrontalCortex["üéØ Prefrontal Cortex<br/>Executive Functions"]
            Planning["Planning Node<br/>‚Ä¢ Goal Setting<br/>‚Ä¢ Strategy Formation<br/>‚Ä¢ Task Decomposition"]
            DecisionMaking["Decision Making<br/>‚Ä¢ Option Evaluation<br/>‚Ä¢ Risk Assessment<br/>‚Ä¢ Choice Selection"]
            Reasoning["Reasoning Engine<br/>‚Ä¢ Logical Analysis<br/>‚Ä¢ Causal Inference<br/>‚Ä¢ Problem Solving"]
        end
        
        subgraph TemporalLobe["üìö Temporal Lobe<br/>Memory Systems"]
            ShortTermMem["Short-term Memory<br/>‚Ä¢ Current Context<br/>‚Ä¢ Recent Interactions<br/>‚Ä¢ Active Tasks"]
            LongTermMem["Long-term Memory<br/>‚Ä¢ Knowledge Base<br/>‚Ä¢ Past Experiences<br/>‚Ä¢ Learned Patterns"]
            SemanticMem["Semantic Memory<br/>‚Ä¢ Embeddings<br/>‚Ä¢ Associations<br/>‚Ä¢ Concepts"]
        end
        
        subgraph ParietalLobe["üîß Parietal Lobe<br/>Tool Integration"]
            ToolRouter["Tool Router<br/>‚Ä¢ Tool Selection<br/>‚Ä¢ Parameter Mapping<br/>‚Ä¢ Capability Matching"]
            ToolExecutor["Tool Executor<br/>‚Ä¢ Safe Execution<br/>‚Ä¢ Result Processing<br/>‚Ä¢ Error Handling"]
        end
    end
    
    subgraph Limbic["üí≠ Limbic System - Emotional & Safety"]
        
        subgraph Amygdala["‚ö†Ô∏è Amygdala<br/>Threat Detection"]
            Guardrails["Guardrails<br/>‚Ä¢ Content Filtering<br/>‚Ä¢ PII Detection<br/>‚Ä¢ Injection Prevention"]
            SafetyCheck["Safety Checker<br/>‚Ä¢ Code Validation<br/>‚Ä¢ Risk Assessment<br/>‚Ä¢ Compliance"]
        end
        
        subgraph Hippocampus["üîÑ Hippocampus<br/>Memory Formation"]
            MemConsolidation["Memory Consolidation<br/>‚Ä¢ Important Events<br/>‚Ä¢ Pattern Recognition<br/>‚Ä¢ Learning"]
        end
    end
    
    subgraph Cerebellum["‚öôÔ∏è Cerebellum - Coordination"]
        WorkflowOrch["Workflow Orchestrator<br/>‚Ä¢ Step Coordination<br/>‚Ä¢ Parallel Processing<br/>‚Ä¢ Synchronization"]
        NodeCoordinator["Node Coordinator<br/>‚Ä¢ Inter-node Communication<br/>‚Ä¢ State Management<br/>‚Ä¢ Resource Allocation"]
    end
    
    subgraph BrainStem["üîå Brain Stem - Core Functions"]
        SessionManager["Session Manager<br/>‚Ä¢ Lifecycle Control<br/>‚Ä¢ State Persistence<br/>‚Ä¢ Recovery"]
        EventBus["Event Bus<br/>‚Ä¢ Message Routing<br/>‚Ä¢ Event Processing<br/>‚Ä¢ Notifications"]
    end
    
    subgraph Motor["ü§ñ Motor Cortex - Actions"]
        ResponseGen["Response Generator<br/>‚Ä¢ Natural Language<br/>‚Ä¢ Structured Output<br/>‚Ä¢ Formatting"]
        ActionExecutor["Action Executor<br/>‚Ä¢ Commands<br/>‚Ä¢ Operations<br/>‚Ä¢ Side Effects"]
    end
    
    subgraph Reflection["üîç Reflection Loop"]
        QualityAnalysis["Quality Analysis<br/>‚Ä¢ Confidence Score<br/>‚Ä¢ Gap Detection<br/>‚Ä¢ Improvement Areas"]
        SelfCorrection["Self-Correction<br/>‚Ä¢ Error Recovery<br/>‚Ä¢ Refinement<br/>‚Ä¢ Optimization"]
    end
    
    %% Neural Pathways (Connections)
    UserQuery --> PrefrontalCortex
    Context --> TemporalLobe
    Signals --> BrainStem
    
    PrefrontalCortex --> Planning
    Planning --> Reasoning
    Reasoning --> DecisionMaking
    
    DecisionMaking --> ToolRouter
    ToolRouter --> ToolExecutor
    
    ShortTermMem <--> LongTermMem
    LongTermMem <--> SemanticMem
    
    TemporalLobe --> MemConsolidation
    MemConsolidation --> LongTermMem
    
    PrefrontalCortex --> Guardrails
    Guardrails --> SafetyCheck
    
    DecisionMaking --> WorkflowOrch
    WorkflowOrch --> NodeCoordinator
    NodeCoordinator --> EventBus
    
    ToolExecutor --> ActionExecutor
    DecisionMaking --> ResponseGen
    
    ActionExecutor --> QualityAnalysis
    ResponseGen --> QualityAnalysis
    QualityAnalysis --> SelfCorrection
    SelfCorrection -.->|Feedback| PrefrontalCortex
    
    %% Output
    ResponseGen --> Output[/"Output<br/>‚Ä¢ Response<br/>‚Ä¢ Actions<br/>‚Ä¢ Updates"/]
    ActionExecutor --> Output
    
    %% Memory Updates
    QualityAnalysis -.->|Learn| MemConsolidation
    
    style CerebralCortex fill:#1e1e3f,stroke:#8b5cf6,stroke-width:3px
    style Limbic fill:#2d1b47,stroke:#ec4899,stroke-width:2px
    style Cerebellum fill:#1e3a5f,stroke:#3b82f6,stroke-width:2px
    style BrainStem fill:#1e453f,stroke:#10b981,stroke-width:2px
    style Motor fill:#3f2e1e,stroke:#f59e0b,stroke-width:2px
    style Reflection fill:#3f1e2e,stroke:#ef4444,stroke-width:2px