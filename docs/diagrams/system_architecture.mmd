%%{init: {'theme':'dark', 'themeVariables': { 'primaryColor':'#1f2937', 'primaryTextColor':'#fff', 'primaryBorderColor':'#7C3AED', 'lineColor':'#F59E0B', 'secondaryColor':'#6366F1', 'tertiaryColor':'#10B981'}}}%%

graph TB
    %% Nighty Code - System Architecture
    %% Shows how all modules integrate and work together
    
    subgraph UserInterface["ğŸ‘¤ User Interface Layer"]
        PythonAPI["Python API<br/>âœ… Implemented<br/>â€¢ Direct import<br/>â€¢ Async/await support<br/>â€¢ Type hints"]
        
        FutureCLI["CLI Tool<br/>ğŸ”® Future<br/>â€¢ Command interface<br/>â€¢ Interactive mode"]
        
        FutureREST["REST API<br/>ğŸ”® Future<br/>â€¢ HTTP endpoints<br/>â€¢ OpenAPI spec"]
    end
    
    subgraph CoreModules["ğŸ§© Core Modules (All Implemented)"]
        
        subgraph Copilot["ğŸ§  Copilot Module"]
            CopilotEngine["Cognitive Engine<br/>â€¢ Multi-hypothesis reasoning<br/>â€¢ Planning & execution<br/>â€¢ Memory management<br/>â€¢ Workflow orchestration"]
        end
        
        subgraph DataMiner["â›ï¸ DataMiner Module"]
            DataMinerEngine["Extraction Engine<br/>â€¢ 4 extraction strategies<br/>â€¢ Schema validation<br/>â€¢ Confidence scoring<br/>â€¢ Type-safe output"]
        end
        
        subgraph LLM["ğŸ¤– LLM Module"]
            LLMEngine["Provider Manager<br/>â€¢ Anthropic & OpenAI<br/>â€¢ Connection pooling<br/>â€¢ Middleware pipeline<br/>â€¢ Structured output"]
        end
        
        subgraph MCP["ğŸ”§ MCP Module"]
            MCPEngine["Tool Manager<br/>â€¢ Filesystem server<br/>â€¢ Tool registry<br/>â€¢ Safe execution<br/>â€¢ Extensible architecture"]
        end
    end
    
    subgraph ModuleIntegration["ğŸ”— Module Integration Patterns"]
        
        CopilotUsesLLM["Copilot â†’ LLM<br/>â€¢ Cognitive nodes<br/>â€¢ Understanding<br/>â€¢ Planning<br/>â€¢ Reasoning"]
        
        CopilotUsesMCP["Copilot â†’ MCP<br/>â€¢ Tool execution<br/>â€¢ File operations<br/>â€¢ Resource access"]
        
        DataMinerUsesLLM["DataMiner â†’ LLM<br/>â€¢ Extraction calls<br/>â€¢ Refinement<br/>â€¢ Validation"]
        
        DataMinerUsesCopilot["DataMiner â†’ Copilot<br/>â€¢ Cognitive strategy<br/>â€¢ Complex reasoning<br/>â€¢ Planning extraction"]
    end
    
    subgraph CommonInfrastructure["ğŸ—ï¸ Common Infrastructure"]
        
        TypeSystem["Type System<br/>â€¢ Pydantic models<br/>â€¢ Type validation<br/>â€¢ Serialization"]
        
        ConfigManagement["Configuration<br/>â€¢ Environment vars<br/>â€¢ Config files<br/>â€¢ Runtime settings"]
        
        ErrorHandling["Error Handling<br/>â€¢ Custom exceptions<br/>â€¢ Recovery strategies<br/>â€¢ Graceful degradation"]
        
        Logging["Logging<br/>â€¢ Module loggers<br/>â€¢ Debug levels<br/>â€¢ Structured logs"]
    end
    
    subgraph ExternalDependencies["â˜ï¸ External Dependencies"]
        
        AIProviders["AI Providers<br/>â€¢ Anthropic API<br/>â€¢ OpenAI API<br/>â€¢ Model selection"]
        
        PythonPackages["Python Packages<br/>â€¢ Pydantic<br/>â€¢ Instructor<br/>â€¢ Async libraries"]
        
        FileSystem["File System<br/>â€¢ Local storage<br/>â€¢ Path operations<br/>â€¢ File I/O"]
    end
    
    subgraph UsagePatterns["ğŸ’¡ Common Usage Patterns"]
        
        Pattern1["Code Analysis<br/>1. User request â†’ Copilot<br/>2. Copilot plans â†’ MCP reads<br/>3. DataMiner extracts â†’ LLM processes<br/>4. Results returned"]
        
        Pattern2["Document Processing<br/>1. Load document â†’ DataMiner<br/>2. Select strategy â†’ LLM extracts<br/>3. Validate schema â†’ Output"]
        
        Pattern3["Interactive Assistant<br/>1. User query â†’ Copilot<br/>2. Multi-hypothesis â†’ Tool selection<br/>3. Execute tools â†’ Response"]
    end
    
    %% User Flow
    PythonAPI --> CoreModules
    FutureCLI -.->|Planned| CoreModules
    FutureREST -.->|Planned| CoreModules
    
    %% Module Dependencies
    CopilotEngine --> LLMEngine
    CopilotEngine --> MCPEngine
    DataMinerEngine --> LLMEngine
    DataMinerEngine --> CopilotEngine
    
    %% Infrastructure Usage
    CoreModules --> TypeSystem
    CoreModules --> ConfigManagement
    CoreModules --> ErrorHandling
    CoreModules --> Logging
    
    %% External Dependencies
    LLMEngine --> AIProviders
    CoreModules --> PythonPackages
    MCPEngine --> FileSystem
    
    %% Integration Examples
    CopilotUsesLLM -.-> Pattern1
    CopilotUsesMCP -.-> Pattern1
    DataMinerUsesLLM -.-> Pattern2
    DataMinerUsesCopilot -.-> Pattern3
    
    style UserInterface fill:#1e3a5f,stroke:#3b82f6,stroke-width:2px
    style CoreModules fill:#1e453f,stroke:#10b981,stroke-width:3px
    style ModuleIntegration fill:#312e4f,stroke:#8b5cf6,stroke-width:2px
    style CommonInfrastructure fill:#1e293b,stroke:#f59e0b,stroke-width:2px
    style ExternalDependencies fill:#2d1b47,stroke:#ec4899,stroke-width:2px
    style UsagePatterns fill:#374151,stroke:#6b7280,stroke-width:2px
    
    %% Implementation Status
    subgraph Legend["ğŸ“Œ System Status"]
        CoreComplete["âœ… Core: All 4 modules fully implemented"]
        IntegrationWorking["ğŸ”— Integration: Modules work together seamlessly"]
        FutureExpansion["ğŸ”® Future: CLI, REST API, Additional MCP servers"]
    end
    
    style Legend fill:#1a1a2e,stroke:#666,stroke-width:1px,stroke-dasharray: 5 5